<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title th:text="${titulo}">Formulario de Antecedente Médico</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style_antecedente.css}">

</head>
<body>

<div class="container my-5">

    <p class="mb-4">
        <a th:href="@{/pacientes/listar}" class="btn btn-sm btn-outline-secondary">
            <i class="fa-solid fa-arrow-left"></i> Volver a la Lista
        </a>
    </p>

    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h1 class="h4 card-title" th:text="${titulo}">Antecedente Médico</h1>
        </div>

        <div class="card-body">

            <div class="alert alert-info py-2" role="alert">
                <small>
                    <strong>Paciente:</strong> <span th:text="${paciente.nombres + ' ' + paciente.apellidos}"></span> |
                    <strong>DNI:</strong> <span th:text="${paciente.dni}"></span>
                </small>
            </div>

            <form th:action="@{'/pacientes/' + ${paciente.idPaciente} + '/antecedentes/guardar'}"
                  th:object="${antecedente}" method="post">

                <input type="hidden" th:field="*{idAntecedente}">
                <input type="hidden" th:field="*{historiaClinica.idHistoria}">

                <div class="mb-3">
                    <label for="tipo" class="form-label"><strong>Tipo de Antecedente:</strong></label>
                    <select id="tipo" th:field="*{tipo}" onchange="mostrarCampoOtro(this.value)" class="form-select" required>
                        <option value="">Seleccione...</option>
                        <option value="Alergias">Alergias</option>
                        <option value="Enfermedades previas">Enfermedades previas</option>
                        <option value="Cirugías">Cirugías</option>
                        <option value="Medicamentos">Medicamentos</option>
                        <option value="Vacunas">Vacunas</option>
                        <option value="Antecedentes familiares">Antecedentes familiares</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>

                <div id="campoOtro" style="display:none;" class="mb-3">
                    <label for="otroTipo" class="form-label"><strong>Especifique otro tipo:</strong></label>
                    <input type="text" id="otroTipo" th:field="*{otroTipo}" placeholder="Ingrese otro tipo" class="form-control">
                </div>

                <div class="mb-3">
                    <label for="descripcion" class="form-label"><strong>Descripción:</strong></label>
                    <textarea id="descripcion" th:field="*{descripcion}" rows="4" placeholder="Describe brevemente el antecedente médico" class="form-control" required></textarea>
                </div>

                <div class="d-flex justify-content-end gap-2 pt-3 border-top">
                    <a th:href="@{/pacientes/listar}" class="btn btn-secondary">Cancelar</a>
                    <button type="submit" class="btn btn-success">
                        <i class="fa-solid fa-save"></i> Guardar Antecedente
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script th:inline="javascript">
    function mostrarCampoOtro(valor) {
        const campoOtro = document.getElementById('campoOtro');
        if (campoOtro) {
            if (valor === 'Otro') {
                campoOtro.style.display = 'block';
            } else {
                campoOtro.style.display = 'none';
                document.getElementById('otroTipo').value = '';
            }
        }
    }

    // Mostrar el campo si ya tiene un valor “Otro” (para edición)
    document.addEventListener("DOMContentLoaded", function () {
        const tipoSelect = document.getElementById('tipo');
        if (tipoSelect) {
            mostrarCampoOtro(tipoSelect.value);
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>